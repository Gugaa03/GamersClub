{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/guga0/Gamersclub/gamersclub-frontend/pages/Checkout.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport { useAuth } from \"@/lib/AuthContext\";\r\nimport { supabase } from \"@/lib/supabaseClient\";\r\n\r\nexport default function CheckoutPage() {\r\n  const router = useRouter();\r\n  const { gameId } = router.query;\r\n  const { user } = useAuth();\r\n  const [game, setGame] = useState<any>(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!gameId) return;\r\n\r\n    async function fetchGame() {\r\n      const { data, error } = await supabase\r\n        .from(\"games\")\r\n        .select(\"*\")\r\n        .eq(\"id\", gameId)\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error(error);\r\n      } else {\r\n        setGame(data);\r\n      }\r\n    }\r\n\r\n    fetchGame();\r\n  }, [gameId]);\r\n\r\n  if (!game) return <p className=\"text-white text-center mt-20\">Carregando jogo...</p>;\r\n\r\n  const handlePurchase = async () => {\r\n    if (!user) return alert(\"Faça login primeiro!\");\r\n    if ((user.balance || 0) < game.price) return alert(\"Saldo insuficiente!\");\r\n\r\n    setLoading(true);\r\n    try {\r\n      // Registrar a compra\r\n      await supabase.from(\"purchases\").insert({\r\n        user_id: user.id,\r\n        game_id: game.id,\r\n        price: game.price,\r\n      });\r\n\r\n      // Atualiza saldo\r\n      const newBalance = (user.balance || 0) - game.price;\r\n      await supabase.from(\"users\").update({ balance: newBalance }).eq(\"id\", user.id);\r\n\r\n      alert(`Compra de ${game.title} realizada com sucesso!`);\r\n      router.push(\"/library\"); // leva para a biblioteca\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert(\"Erro ao processar a compra.\");\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-900 text-white p-8\">\r\n      <h1 className=\"text-3xl font-bold mb-6\">Checkout</h1>\r\n      <div className=\"flex items-center gap-4 bg-gray-800 p-4 rounded-lg mb-6\">\r\n        <img src={game.image} className=\"w-24 h-24 object-cover rounded\" />\r\n        <div>\r\n          <h2 className=\"text-xl font-semibold\">{game.title}</h2>\r\n          <p className=\"text-gray-300\">Preço: €{game.price.toFixed(2)}</p>\r\n        </div>\r\n      </div>\r\n      <button\r\n        onClick={handlePurchase}\r\n        disabled={loading}\r\n        className=\"bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-bold transition disabled:opacity-50\"\r\n      >\r\n        {loading ? \"Processando...\" : \"Comprar Agora\"}\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOe,SAAS;IACtB,MAAM,SAAS,IAAA,oIAAS;IACxB,MAAM,EAAE,MAAM,EAAE,GAAG,OAAO,KAAK;IAC/B,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,uHAAO;IACxB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,+GAAQ,EAAM;IACtC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+GAAQ,EAAC;IAEvC,IAAA,gHAAS,EAAC;QACR,IAAI,CAAC,QAAQ;QAEb,eAAe;YACb,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,0HAAQ,CACnC,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,QACT,MAAM;YAET,IAAI,OAAO;gBACT,QAAQ,KAAK,CAAC;YAChB,OAAO;gBACL,QAAQ;YACV;QACF;QAEA;IACF,GAAG;QAAC;KAAO;IAEX,IAAI,CAAC,MAAM,qBAAO,qKAAC;QAAE,WAAU;kBAA+B;;;;;;IAE9D,MAAM,iBAAiB;QACrB,IAAI,CAAC,MAAM,OAAO,MAAM;QACxB,IAAI,CAAC,KAAK,OAAO,IAAI,CAAC,IAAI,KAAK,KAAK,EAAE,OAAO,MAAM;QAEnD,WAAW;QACX,IAAI;YACF,qBAAqB;YACrB,MAAM,0HAAQ,CAAC,IAAI,CAAC,aAAa,MAAM,CAAC;gBACtC,SAAS,KAAK,EAAE;gBAChB,SAAS,KAAK,EAAE;gBAChB,OAAO,KAAK,KAAK;YACnB;YAEA,iBAAiB;YACjB,MAAM,aAAa,CAAC,KAAK,OAAO,IAAI,CAAC,IAAI,KAAK,KAAK;YACnD,MAAM,0HAAQ,CAAC,IAAI,CAAC,SAAS,MAAM,CAAC;gBAAE,SAAS;YAAW,GAAG,EAAE,CAAC,MAAM,KAAK,EAAE;YAE7E,MAAM,CAAC,UAAU,EAAE,KAAK,KAAK,CAAC,uBAAuB,CAAC;YACtD,OAAO,IAAI,CAAC,aAAa,yBAAyB;QACpD,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC;YACd,MAAM;QACR;QACA,WAAW;IACb;IAEA,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBAAG,WAAU;0BAA0B;;;;;;0BACxC,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAI,KAAK,KAAK,KAAK;wBAAE,WAAU;;;;;;kCAChC,qKAAC;;0CACC,qKAAC;gCAAG,WAAU;0CAAyB,KAAK,KAAK;;;;;;0CACjD,qKAAC;gCAAE,WAAU;;oCAAgB;oCAAS,KAAK,KAAK,CAAC,OAAO,CAAC;;;;;;;;;;;;;;;;;;;0BAG7D,qKAAC;gBACC,SAAS;gBACT,UAAU;gBACV,WAAU;0BAET,UAAU,mBAAmB;;;;;;;;;;;;AAItC","debugId":null}}]
}